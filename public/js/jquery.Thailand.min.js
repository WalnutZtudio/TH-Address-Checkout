"use strict";!function(p){p.Thailand=function(c){c=p.extend({database:"https://earthchie.github.io/jquery.Thailand.js/jquery.Thailand.js/database/db.json",database_type:"auto",zip_worker_path:!1,autocomplete_size:20,onLoad:function(){},onDataFill:function(){},$district:!1,$district_code:!1,$amphoe:!1,$amphoe_code:!1,$province:!1,$province_code:!1,$zipcode:!1,$search:!1},c);var n=function(e){var r,t=[],a=[],c=[],n=!1;return e.lookup&&e.words&&(n=!0,t=e.lookup.split("|"),a=e.words.split("|"),e=e.data),r=function(e){return n?("number"==typeof e&&(e=t[e]),e.replace(/[A-Z]/gi,function(e){var t=e.charCodeAt(0);return a[t<97?t-65:26+t-97]})):e},e[0].length?(e.map(function(i){var o=1;3===i.length&&(o=2),i[o].map(function(n){n[o].map(function(a){a[o]=a[o]instanceof Array?a[o]:[a[o]],a[o].map(function(e){var t={district:r(a[0]),amphoe:r(n[0]),province:r(i[0]),zipcode:e};2===o&&(t.district_code=a[1]||!1,t.amphoe_code=n[1]||!1,t.province_code=i[1]||!1),c.push(t)})})})}),c):e},s=function e(t,a,n){a+="";var i,o,r,c,s=0,p=0,h=0,d=(t+="").length,l=a.length;for(i=0;i<d;i+=1)for(o=0;o<l;o+=1){for(r=0;i+r<d&&o+r<l&&t.charAt(i+r)===a.charAt(o+r);)r+=1;h<r&&(h=r,s=i,p=o)}return(c=h)&&(s&&p&&(c+=e(t.substr(0,p),a.substr(0,p),!1)),s+h<d&&p+h<l&&(c+=e(t.substr(s+h,d-s-h),a.substr(p+h,l-p-h),!1))),!1===n?c:t===a?100:l<d?Math.floor(c/d*100):Math.floor(c/l*100)};!function(a){var e,t=c.database_type.toLowerCase();switch("json"!==t&&"zip"!==t&&(t=c.database.split(".").pop()),t){case"json":p.getJSON(c.database,function(e){a(new JQL(n(e)))}).fail(function(e){throw new Error('File "'+c.database+'" is not exists.')});break;case"zip":c.zip_worker_path||p("script").each(function(){var e=this.src.split("/");"zip.js"===e.pop()&&(zip.workerScriptsPath=e.join("/")+"/")}),(e=new XMLHttpRequest).responseType="blob",e.onreadystatechange=function(){if(4===e.readyState){if(200!==e.status)throw new Error('File "'+c.database+'" is not exists.');zip.createReader(new zip.BlobReader(e.response),function(e){e.getEntries(function(e){e[0].getData(new zip.BlobWriter,function(e){var t=new FileReader;t.onload=function(){a(new JQL(n(JSON.parse(t.result))))},t.readAsText(e)})})})}},e.open("GET",c.database),e.send();break;default:throw new Error('Unknown database type: "'+c.database_type+'". Please define database_type explicitly (json or zip)')}}(function(i){var a,n,o,r,e={empty:" ",suggestion:function(e){return e.zipcode&&(e.zipcode=" » "+e.zipcode),"<div>"+e.district+" » "+e.amphoe+" » "+e.province+e.zipcode+"</div>"}};for(a in c)-1<a.indexOf("$")&&"$search"!==a&&c.hasOwnProperty(a)&&c[a]&&c[a].typeahead({hint:!0,highlight:!0,minLength:1},{limit:c.autocomplete_size,templates:e,source:function(e,t){var a=[],n=this.$el.data("field");try{a=i.select("*").where(n).match("^"+e).orderBy(n).fetch()}catch(e){}t(a)},display:function(e){return e[this.$el.data("field")]}}).parent().find(".tt-dataset").data("field",a.replace("$",""));for(a in c.$search&&c.$search.typeahead({hint:!0,highlight:!0,minLength:2},{limit:c.autocomplete_size,templates:e,source:function(t,e){var n,a=[];try{a=new JQL(a.concat(i.select("*").where("district").match(t).fetch()).concat(i.select("*").where("amphoe").match(t).fetch()).concat(i.select("*").where("province").match(t).fetch()).concat(i.select("*").where("zipcode").match(t).fetch()).filter(function(e,t,a){for(n=0;n<a.length;n+=1)if(t!==n&&a[n].amphoe===e.amphoe&&a[n].district===e.district)return!1;return!0}).map(function(e){return e.likely=[5*s(t,e.district),3*s(t,e.amphoe.replace(/^เมือง/,"")),s(t,e.province),s(t,e.zipcode)].reduce(function(e,t){return Math.max(e,t)}),e})).select("*").orderBy("likely desc").fetch()}catch(t){}e(a)},display:function(e){return""}}),c)-1<a.indexOf("$")&&c.hasOwnProperty(a)&&c[a]&&c[a].bind("typeahead:select typeahead:autocomplete",function(e,t){for(a in c)n=a.replace("$",""),-1<a.indexOf("$")&&c.hasOwnProperty(a)&&c[a]&&t[n]&&c[a].typeahead("val",t[n]).trigger("change");"billing"==c.type?r="billing_state":"shipping"==c.type&&(r="shipping_state"),t.province&&r&&((o=p("#"+r+' option:contains("'+t.province+'")'))[0]||"พระนครศรีอยุธยา"!=t.province||(o=p("#"+r+' option:contains("อยุธยา")')),o[0].value&&p("#"+r).val(o[0].value).trigger("change")),"function"==typeof c.onDataFill&&(delete t.likely,c.onDataFill(t))}).blur(function(){this.value||p(this).parent().find(".tt-dataset").html("")});"function"==typeof c.onLoad&&c.onLoad(),"function"==typeof c.onComplete&&c.onComplete()})}}(jQuery);
